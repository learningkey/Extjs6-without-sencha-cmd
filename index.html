<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	
	<!-- Production -->
    <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/extjs/6.2.0/ext-all.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/extjs/6.2.0/classic/theme-triton/resources/theme-triton-all.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/extjs/6.2.0/classic/theme-triton/theme-triton.js"></script> -->
	
	<!-- Development -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/extjs/6.2.0/ext-all-debug.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/extjs/6.2.0/classic/theme-triton/resources/theme-triton-all-debug.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/extjs/6.2.0/classic/theme-triton/theme-triton-debug.js"></script>
    
    <link rel="stylesheet" type="text/css" href="./style.css" />
    
    <script type="text/javascript">
        // create store
        Ext.create('Ext.data.Store', {
            storeId: 'customerStoreId',
            pageSize: 10,
            autoLoad: true,
            fields:[
                {name: 'id', type: 'int'},
                {name: 'name', type: 'string'},
                {name: 'phone', type: 'string'},
                {name: 'address', type: 'string'}
            ],
            proxy: {
                type: 'ajax',
                url: 'data.json',
                reader: {
                    type: 'json',
                    rootProperty: 'data',
                    totalProperty: 'total'
                }
            }
            
        });

        //controller
        Ext.define('CustomerController', {
            extend: 'Ext.app.ViewController',
            alias: 'controller.customercontroller',
            init: function(application){
                this.control({
                    "#customerGridId": {
                        itemdblclick: this.griditemdbdclick
                    }
                });
            },
            seachHandler: function(btn){
                var searchText = this.lookupReference('searchText');
                alert(searchText.getValue());
            },
            onSearchTextHandler: function(obj, e, oPts){
                if(e.getKey() == e.ENTER){
                    var searchButton = Ext.getCmp('customerGridId').lookupReference('searchButton');
                    searchButton.click();
                }
            },
            resetHandler: function(btn){
                var searchInput = Ext.getCmp('customerGridId').lookupReference('searchText');
                searchInput.setValue('');
            },
            griditemdbdclick: function(dv, record, item, index, e){
                console.log(record);
                var name = record.get("name");
                alert(name);
            },
            onDeleteHandler: function(grid, rowIndex, colIndex){
                var rec = grid.getStore().getAt(rowIndex);
                Ext.Msg.alert('Delete', rec.get('name'));
            },
            onEditHandler: function(grid, rowIndex, colIndex){
                var rec = grid.getStore().getAt(rowIndex);
                Ext.Msg.alert('Edit', rec.get('name'));
            }
        });

        // Create First Application
        Ext.application({
            name: 'Customer',
            launch: function(){
                //create Grid
                Ext.create('Ext.grid.Panel', {
                    controller: 'customercontroller',
                    title: 'Customer list',
                    store: Ext.data.StoreManager.lookup('customerStoreId'), // or use Ext.getStore('customerStoreId')
                    id: 'customerGridId',
                    height: 300,
                    width: 600,
                    frame: true,
                    actions: {
                        delete: {
                            iconCls: 'x-fa fa-trash-o red',
                            tooltip: 'Delete',
                            handler: 'onDeleteHandler'
                        },
                        edit: {
                            iconCls: 'x-fa fa-pencil-square blue',
                            tooltip: 'Edit',
                            handler: 'onEditHandler'
                        }
                    },
                    columns: [
                        {text: 'ID', dataIndex: 'id', flex: 1},
                        {text: 'Name', dataIndex: 'name', flex: 1},
                        {text: 'Phone', dataIndex: 'phone', flex: 1},
                        {text: 'Address', dataIndex: 'address', flex: 1},
                        {
                            width: 70,
                            sortable: false,
                            menuDisabled: true,
                            xtype: 'actioncolumn',
                            items: ['@delete', '@edit']
                        }
                    ],
                    renderTo: Ext.getBody(),
                    //Add Pagination toolbar, Paging not working yet, this just sample
                    bbar: {
                        xtype: 'pagingtoolbar',
                        displayInfo: true,
                        displayMsg: 'Display records {0} - {1} of {2}',
                        emptyMsg: 'No Record to display'
                    },
                    tbar: [
                        {
                            xtype: 'textfield',
                            emptyText: 'Search...',
                            width: 200,
                            reference: 'searchText',
                            enableKeyEvents: true,
                            listeners: {
                                keyup: 'onSearchTextHandler'
                            }
                        },
                        {
                            xtype: 'button',
                            text: 'Search',
                            iconCls: 'x-fa fa-search blue',
                            handler: 'seachHandler',
                            reference: 'searchButton'
                        },
                        {
                            xtype: 'button',
                            text: 'Refresh',
                            iconCls: 'x-fa fa-refresh blue',
                            handler: 'resetHandler'
                        }
                    ]
                });

            }
        });

    </script>
</head>
<body>
    
</body>
</html>